## 互联网的基本结构和家庭、公司网络是相同的

![image-20200327094605959](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200327094605959.png)

互联网和家庭、公司网络不同的地方：

- 转发设备间的距离
- 路由器如何控制包的转发目标（路由表记录的维护方式）



## ADSL

![image-20200328092720755](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200328092720755.png)

![image-20200327123608020](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200327123608020.png)

![image-20200327125007964](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200327125007964.png)

### ADSL通过使用多个波来提高速率

ADSL 使用间隔为 4.3125 kHz 的上百个不同频率的波进行合成，每个波都采用正交振幅调制，而且，根据噪声等条件的不同，每个波表示的比特数是可变的。也就是说，噪声小的频段可以给波分配更多的比特，噪声大的频段则给波分配较少的比特 ，每个频段表示的比特数加起来，就决定了整体的传输速率。

![image-20200327125939260](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200327125939260.png)

下行的频段频率较高，容易衰减和受到噪声影响，因此这些频段可能只能表示较少的比特数，或者干脆无法传输信号。距离越远，频率越高，这种情况越明显。因此如果家庭距离电话局太远，速率会下降。

### 分离器

如上图，分离器的主要作用在于，接收信号时（发送信号时，并不做什么），将电话频段以上的ADSL信号过滤掉，然后传给电话机。Model自身已经具备过滤低频信号的功能，因此分离器在Model端并不做什么。

分离器防止ADSL对电话产生干扰，同时也防止电话对ADSL产生干扰。

当放下听筒时，电话机的电路和电话线是断开的， 当拿起听筒时电话机就和电话线相连，电话机的信号就会传到电话线上。 这两种状态的差异会导致噪声等线路状态的改变，如果 ADSL 通信过程中拿起话筒导致线路状态改变，就需要重新训练(握手)，这就会导致几十秒 的通信中断，分离器可以防止发生这样的问题（过滤高频杂波）。



## FTTH

### 光纤

![image-20200327141533682](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200327141533682.png)

![image-20200327141543548](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200327141543548.png)

![image-20200327151304708](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200327151304708.png)

![image-20200327153136169](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200327153136169.png)

纤芯直径会极大地改变光纤的性质。

单模光纤的纤芯很细，只有入射角很小的光线才能进入，因此在能够保持相位一致的角度中，只有角度最小的光线能进入光纤。 反过来可以说，单模光纤的纤芯直径就是按照只允许相位一致的最小角度的光进入而设计的。多模光纤的纤芯比较粗，入射角比较大的光也可以进入，这样一来，在相位一致的角度中，不仅角度最小的可以在光纤中传导，其他角度更大一些的也可以，也就是说，可以有多条光线在纤芯中同时传导。换句话说，单模和多模实际上表示相位一致的角度有一个还是多个。

![image-20200327154323335](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200327154323335.png)

![image-20200327154834302](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200327154834302.png)

### 通过光纤分路来降低成本

波分复用：在一条光纤中使用不同波长传输多个光信号的方式。

FTTH形态上大致分为两种：

- 直连方式
- 分路方式

![image-20200328092847201](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200328092847201.png)



## PPP和隧道

### PPP

![image-20200328104923898](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200328104923898.png)

![image-20200328105731936](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200328105731936.png)

![image-20200328110439312](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200328110439312.png)

### 隧道

![image-20200328121100440](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200328121100440.png)

### 接入网的整体工作过程

1. 接入路由器配置运营商分配的用户名密码
2. 接入路由器根据PPPoE的发现机制（类似于ARP）来寻找BAS（相当于拨号上网中拨通电话的动作）
3. 用户认证
   - CHAP 挑战握手认证协议（加密）
   - PAP 密码验证协议（不加密）
4. 下发配置：IP地址、DNS服务器的IP地址、默认网关的IP地址
5. 客户端发送网络包
6. 在接入路由器的路由表中没找到
7. 将这个包转发给默认路由的网关地址
8. 包按照PPPoE而不是MAC规则转发
9. 网络包到达BAS
10. BAS取出PPP头部和后面的部分，通过隧道将包发送到运营商的路由器

![image-20200328123444812](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200328123444812.png)

### 除PPPoE之外的其他方式

PPPoA 方式不添加 MAC 头部和 PPPoE 头部，而是直接将包装入信元中。

DHCP

![image-20200328134001455](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200328134001455.png)





## 网络运营商内部

### POP和NOC

POP：Point of Presence 接入点

NOC：Network Operation Center 网络运行中心（可以简单认为，NOC就是规模更大的POP）

![image-20200328134416224](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200328134416224.png)

![image-20200328134634358](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200328134634358.png)



## 跨越运营商的网络包

![image-20200328141833212](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200328141833212.png)

互联网内部使用 BGP 机制在运营商之间交换路由信息。

![image-20200328142119791](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200328142119791.png)

![image-20200328142516492](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200328142516492.png)

![image-20200328142800550](../通过接入网进入互联网内部/通过接入网进入互联网内部.assets/image-20200328142800550.png)
